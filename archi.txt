┌─────────────────────────────────────────────────────────────────┐
│                        SOURCES DE DONNÉES                        │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
            ┌───────▼────────┐  ┌──────▼───────┐
            │  TomTom API    │  │ Générateur   │
            │  (Temps Réel)  │  │ (Simulation) │
            └───────┬────────┘  └──────┬───────┘
                    │                   │
                    └─────────┬─────────┘
                              │
┌─────────────────────────────▼─────────────────────────────────┐
│                      INGESTION (Speed Layer)                   │
│  ┌──────────────────────────────────────────────────────┐    │
│  │  Kafka Producer (Python)                              │    │
│  │  - Collecte données TomTom toutes les 60s            │    │
│  │  - Publie dans Kafka topic: traffic_raw              │    │
│  └──────────────────────────────────────────────────────┘    │
└───────────────────────────────────┬───────────────────────────┘
                                    │
┌───────────────────────────────────▼───────────────────────────┐
│                    MESSAGE BROKER (Kafka)                      │
│  ┌──────────────────────────────────────────────────────┐    │
│  │  Apache Kafka + Zookeeper                             │    │
│  │  - Topic: traffic_raw                                 │    │
│  │  - Partition: 1                                       │    │
│  │  - Retention: 7 jours                                 │    │
│  └──────────────────────────────────────────────────────┘    │
└───────────────────────────────────┬───────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
┌───────────────────▼──────────┐  ┌────────────────▼─────────────┐
│  TRAITEMENT TEMPS RÉEL       │  │  TRAITEMENT BATCH             │
│  (Speed Layer)               │  │  (Batch Layer)                │
│  ┌─────────────────────────┐│  │  ┌──────────────────────────┐│
│  │ Spark Streaming         ││  │  │ Script d'import          ││
│  │ - Lit Kafka             ││  │  │ - Génère données         ││
│  │ - Nettoie données       ││  │  │ - Écrit dans HDFS        ││
│  │ - Écrit PostgreSQL      ││  │  │ - Crée agrégats          ││
│  │ - Écrit HDFS (append)   ││  │  └──────────────────────────┘│
│  └─────────────────────────┘│  │                               │
└──────────────┬───────────────┘  └────────────┬──────────────────┘
               │                               │
               │  ┌────────────────────────────┘
               │  │
┌──────────────▼──▼──────────────────────────────────────────────┐
│                    COUCHE DE STOCKAGE                           │
│  ┌─────────────────────┐  ┌──────────────────────────────┐   │
│  │   PostgreSQL        │  │   HDFS (Hadoop)              │   │
│  │   (Temps Réel)      │  │   (Historique)               │   │
│  │   - zones           │  │   - /traffic/clean           │   │
│  │   - traffic_data    │  │   - /traffic/aggregates      │   │
│  │   - agrégats        │  │   - Format: Parquet          │   │
│  └─────────────────────┘  └──────────────────────────────┘   │
└────────────────────────────────┬────────────────────────────────┘
                                 │
┌────────────────────────────────▼────────────────────────────────┐
│                      COUCHE API (FastAPI)                        │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  Backend Python FastAPI                               │      │
│  │  - GET /api/zones/live (PostgreSQL)                   │      │
│  │  - GET /api/zones/weekly-data?days=7 (HDFS+Spark)     │      │
│  │  - GET /api/zones/hourly-distribution?days=7 (HDFS)   │      │
│  │  - GET /api/zones/hdfs-stats (HDFS)                   │      │
│  │  - WebSocket /ws/traffic (Temps Réel)                 │      │
│  └──────────────────────────────────────────────────────┘      │
└────────────────────────────────┬────────────────────────────────┘
                                 │
┌────────────────────────────────▼────────────────────────────────┐
│                    COUCHE PRÉSENTATION                           │
│  ┌──────────────────────────────────────────────────────┐      │
│  │  Frontend React + Vite                                │      │
│  │  - Dashboard Temps Réel                               │      │
│  │  - Carte Interactive (Leaflet)                        │      │
│  │  - Analytics (Recharts)                               │      │
│  │  - WebSocket Client                                   │      │
│  └──────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────┘